# 一个没成功的跨域解决方案
## 前言
   首先，这个跨域方案失败了，最终的505磨灭了我最后坚持的信念，项目的时间成本不允许我继续搞下去了，于是准备转入零碎时间去继续研究了。这个没成功的跨域方案还是值得纪念一下的，先简单介绍一下背景吧，我负责的项目自带一套playframework框架的服务端，也就是说，这个项目有两个后端！我已经懒得去说明为什么会有两个了，前人的锅，无论怎样都得背，让一个前端去学习Scala和恶心的要死的play框架，还要不耽误进度的完成前端的开发内容。好吧，确实有点儿想骂娘。但现实总要面对的，现在的问题是，项目所有参与人都希望拆掉这一层，在对项目的未来规划中，希望逐步用某种方法替换掉这层Scala服务。在这次迭代中，因为要替换一些新接口，我便希望从前端的角度，剥离这层服务，新接口就用新的封装直接请求后端服务。但是令人发狂的是，这个项目需要请求的服务地址多达6个，没辙，跨域就是剥离的第一道坎儿，而两天的时间，我也是跪倒在这道坎儿上了。

## 第一天
   第一天，主要是构想解决方案和安装相关软件，首先替换的内容就是直接用fetch请求接口，再去配置control-origin即可。但是发现cookie带不上了，fetch的headers中cookie是被禁止修改的，于是我使用mode:'cros'，credentials ： 'include'等配置项，妄图将localhost：9000（Scala服务地址）的cookie携带入hl-test.com这个服务端口，后续发现cookie的domain需要配置才可，费了半天劲找到了play中Cookie domain的配置，但是也仅仅是配置domain而不是其他域，基本上来讲这条路就封死了。更奇怪的是，headers中的内容没有一次能够成功配置好的。

## 第二天
   第二天，当发现domian最多就是降域时，我想到了nginx，我想用nginx代理一个localhost:8000，domain设定为localhost，这样fetch就能携带cookie信息了，nginx中针对特定的location，使用proxy-pass代理到hl-test.com地址。完美吧，homebrew、nginx、echo、nginx.conf，我一步步试，单独访问localhost:8000的时候，终于反向代理到了hl-test.com并成功的取出了数据。为什么说单独呢，因为在localhost:9000中请求8000跨域了！

## 第三天
   第三天，浏览器疯狂的报着跨域的错误，就是Scala服务和nginx服务的跨域，我曾经尝试着使用同一个端口号，但是显然是痴心妄想了，于是开始需要play框架如何配置http的，该死的play框架的API。总是顾左右而言他，而API中有阐述的太简单，找一个配置项和配置项的具体使用方法非常困难，有些连续的引用，如server.http.port，并没有完整的链条，仅仅是在某些特殊启动形式中仅有的一条配置项，并没发去设置其他内容，而繁琐的filter配置过程，并没有地方去验证你是否配置正确的，也或许是我了解的太浅，哦对了，play的配置方法和形式很多种，可以是一个对象，可以是一个字符串，而且使用了后，并没有地方能够查看你使用的play的版本，而无法准确找到API。唉~，真TM惨！我只能摸着石头过河，但是我最后放弃了这个filter的配置，因为我觉得我该配置的都配置了，可是在9000端口中8000的请求依旧是跨域的！好吧，好吧，我觉得再从nginx入手，如果我将Scala服务也视为一个标准后端服务的话，我用nginx代理这个服务好不好！我访问8000端口，但是location除了特定路径全部代理到9000上去！或者利用upstream这个配置，将location / 负载到9000上去。两者都能到达我访问nginx，然后代理到不同服务地址的目的！然而，又一个诡异的问题出现了，自定义的JS，CSS文件全部505了，是的像项目目录下的jQuery.min.js都能顺利加载，而相邻目录的打包好的index.js却无法顺利加载出来，全部是505，我甚至都不知道这个代码背后所代表真实错误是什么，tell me why ? index.js的目录是没有问题的，我尝试了一下，如果路径不对是标准的404错误，只有路径正确才会是505，可是为什么其他目录的静态文件引用没有任何问题，偏偏系统的几个自定义文件就会有问题，如果说webpack打包后的文件格式有问题，但是为何一个base.css这种文件都报505！上帝啊，哪位天使姐姐能救救我啊！